<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js" defer></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>
    
    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js" defer></script>

    <title>World-Chat</title>

    <!-- Fonts and Styles -->
    <link
      href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/emoji-mart@latest/css/emoji-mart.css"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <link rel="icon" type="image/png" href="/favicon.png" />

    <link rel="stylesheet" href="./styling.css" />
    <!-- Link to the separate stylesheet for the toggle switch -->
    <link rel="stylesheet" href="./toggle-switch.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body>
    <!-- NEW: Debug overlay for mobile view -->
    <!-- <div id="debug-overlay"></div> -->

    <div class="custom-cursor"><div class="cursor-dot"></div></div>

    <div class="terminal">
      <div class="terminal-header">
        Chat Terminal
        <!-- NEW: Help button for mobile -->
        <button class="help-button-mobile" id="help-button-mobile" aria-label="Show Help">?</button>
        <button class="disconnect-button" id="disconnect-button" aria-label="Disconnect/Connect">
            <span>âŒ€</span>
        </button>
      </div>

      <div class="status-bar">
        <div class="connection-status">Welcome to World-Chat Terminal!</div>
        <div class="clock">00:00:00</div>
        <div class="users-online">
          Users online: <span class="user-count">0</span>
        </div>
      </div>

      <div class="chat-messages">
        <!-- Messages will be dynamically inserted here -->
      </div>
      
      <!-- REPLACE the old .chat-input div with this new wrapper structure -->
      <div class="input-area-wrapper">
        <!-- The pickers are now direct children of the wrapper -->
        <div id="emoji-picker" class="picker-container"></div>
        <div id="gif-picker" class="picker-container">
          <input type="text" id="gif-search" placeholder="Search GIFs..." />
          <div id="gif-results"></div>
        </div>

        <!-- The chat input bar is now a sibling to the pickers -->
        <div class="chat-input">
          <!-- Wrap buttons and toggle in a new div for better flexbox control on mobile -->
          <div class="buttons-wrapper">
            <button id="emoji-button" aria-label="Open emoji picker">ðŸ˜Š</button>
            <button id="gif-button" aria-label="Open GIF picker">GIF</button>

            <!-- AI Toggle Switch -->
            <div class="ai-toggle-container">
                <div class="neo-toggle-container">
                  <input class="neo-toggle-input" id="ai-public-toggle" type="checkbox" title="Toggle Advanced AI" />
                  <label class="neo-toggle" for="ai-public-toggle">
                    <div class="neo-track">
                      <div class="neo-background-layer"></div>
                      <div class="neo-grid-layer"></div>
                      <!-- <div class="neo-spectrum-analyzer absolute bottom-2 top-3 left-0 w-9 h-1/3 flex justify-around items-end">
                        <div class="neo-spectrum-bar w-1 bg-cyan-400"></div>
                        <div class="neo-spectrum-bar w-1 bg-cyan-400"></div>
                        <div class="neo-spectrum-bar w-1 bg-cyan-400"></div>
                        <div class="neo-spectrum-bar"></div>
                        <div class="neo-spectrum-bar"></div>
                      </div> -->
                      <div class="neo-track-highlight"></div>
                    </div>
                    <div class="neo-thumb">
                      <div class="neo-thumb-ring"></div>
                      <div class="neo-thumb-core">
                        <div class="neo-thumb-icon">
                          <div class="neo-thumb-wave"></div>
                          <div class="neo-thumb-pulse"></div>
                        </div>
                      </div>
                    </div>
                    <div class="neo-gesture-area"></div>
                    <div class="neo-interaction-feedback">
                      <div class="neo-ripple"></div>
                      <div class="neo-progress-arc"></div>
                    </div>
                    <div class="neo-status">
                      <div class="neo-status-indicator">
                        <div class="neo-status-dot"></div>
                        <div class="neo-status-text"></div>
                      </div>
                    </div>
                  </label>
                </div>
            </div>
          </div>

          <textarea
            id="message-input" 
            placeholder="Type your message... (Enter to send, Shift+Enter for new line)"
            class="input"
            aria-label="Chat input"
            rows="1"
          ></textarea>

          <button id="send-button" aria-label="Send message" data-shortcut="Ctrl+Enter">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor" aria-hidden="true">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Application Scripts -->
    <script src="client.js" defer></script>
    <script src="support.js" defer></script>
  </body>
</html>
